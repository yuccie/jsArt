---
layout: post
title: 浏览器工作原理和实践
date: Sat Nov 24 2018 14:53:50 GMT+0800 (中国标准时间)
---


### V8工作原理

#### 编译器和解释器：V8是如何执行一段JavaScript代码的?

V8 在执行过程中既有解释器 Ignition和编译器 TurboFan。

一、将源代码生成AST和执行上下文

1. 无论解释性语言还是编译性语言，在编译过程中，都会生成AST。
2. 编译器和解释器理解的只有AST。
3. babel的原理是先将ES6转为AST，然后再将ES6的AST转为ES5的AST，最后ES5的AST生成js源代码。
4. 生成AST需要先分词(将源码拆解为一个个的token)，然后再词法分析(根据语法规则将token转为AST)

二、生成字节码

1. 有了AST和执行上下文，解释器Ignition会根据AST生成字节码，并解释执行字节码
  
**注意：**其实一开始 V8 并没有字节码，而是直接将 AST 转换为机器码，由于执行机器码的效率是非常高效的，所以这种方式在发布后的一段时间内运行效果是非常好的。但是随着 Chrome 在手机上的广泛普及，特别是运行在 512M 内存的手机上，内存占用问题也暴露出来了，因为 V8 需要消耗大量的内存来存放转换后的机器码。为了解决内存占用问题，V8 团队大幅重构了引擎架构，引入字节码，并且抛弃了之前的编译器，最终花了将进四年的时间，实现了现在的这套架构。

**机器码所占用的空间远远超过了字节码**，所以使用字节码可以减少系统的内存使用

三、执行代码


### 浏览器中的页面循环系统

#### 消息队列和事件循环：页面是怎么“活”起来的
