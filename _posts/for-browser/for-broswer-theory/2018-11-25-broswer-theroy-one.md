---
layout: post
title: 浏览器工作原理和实践
date: Sat Nov 24 2018 14:53:50 GMT+0800 (中国标准时间)
---


### 前言
### 宏观视角下的浏览器


### 浏览器中js执行机制
### V8工作原理

#### 编译器和解释器：V8是如何执行一段JavaScript代码的?

- 静态语言，在使用之前就需要确认其变量数据类型的称为静态语言。
- 动态语言，在运行过程中需要检查数据类型的语言称为动态语言，比如js，因为在声明变量之前并不需要确定其数据类型。
- 弱类型语言，支持隐私类型转换的语言称为弱类型。
- 强类型语言，不支持隐私类型转换的语言称为强类型语言。

**JavaScript 是一种弱类型的、动态的语言**，意味着什么呢？

- 弱类型，意味着不需要告诉js引擎变量是什么类型，引擎在代码运行的时候会计算出来。
- 动态，意味着可以用同一个变量保存不同类型的数据。

之所以存在编译器和解释器，是因为机器不能直接理解我们所写的代码，所以在执行程序之前，需要将代码翻译成机器能懂的机器语言。按**语言的执行流程**分为**编译型和解释性**语言。

- 编译型语言，在执行程序之前，需要经过编译器的编译过程，并且编译之后会直接保留机器能读懂的二进制文件，这样在每次运行程序时，都可以直接运行该二进制文件，而不需要再次重新编译了。比如C/C++，GO等都是编译型语言。
- 解释性语言，在每次运行时都需要通过**解释器对程序进行动态解释和执行**。比如Python，JavaScript等。


V8 在执行过程中既有解释器 Ignition和编译器 TurboFan。

一、将源代码生成AST和执行上下文

1. 无论解释性语言还是编译性语言，在编译过程中，都会生成AST。
2. 编译器和解释器理解的只有AST。
3. babel的原理是先将ES6转为AST，然后再将ES6的AST转为ES5的AST，最后ES5的AST生成js源代码。
4. 生成AST需要先分词(将源码拆解为一个个的token)，然后再词法分析(根据语法规则将token转为AST)

二、生成字节码

1. 有了AST和执行上下文，解释器Ignition会根据AST生成字节码，并解释执行字节码
  
**注意：**其实一开始 V8 并没有字节码，而是直接将 AST 转换为机器码，由于执行机器码的效率是非常高效的，所以这种方式在发布后的一段时间内运行效果是非常好的。但是随着 Chrome 在手机上的广泛普及，特别是运行在 512M 内存的手机上，内存占用问题也暴露出来了，因为 V8 需要消耗大量的内存来存放转换后的机器码。为了解决内存占用问题，V8 团队大幅重构了引擎架构，引入字节码，并且抛弃了之前的编译器，最终花了将进四年的时间，实现了现在的这套架构。

**机器码所占用的空间远远超过了字节码**，所以使用字节码可以减少系统的内存使用

三、执行代码

#### 编译器和解释器


### 浏览器中的页面循环系统
### 浏览器中的页面
### 浏览器中的网络
### 浏览器安全
### V8工作原理




### 浏览器中的页面循环系统

#### 消息队列和事件循环：页面是怎么“活”起来的
